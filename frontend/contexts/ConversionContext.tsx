

import React, { createContext, useEffect, useRef, useState } from 'react';

// const sampleConversion = {
//   "1INCH": "1.3869625520110957",
//   AAVE: "0.0104042032981324",
//   ACH: "76.4467548352572433",
//   ADA: "2.0286033066233898",
//   AED: "3.6730999788429441",
//   AERGO: "7.4766355140186916",
//   AFN: "89.1413759999997153",
//   AGLD: "2.3499001292445071",
//   AIOZ: "13.5961930659415364",
//   ALCX: "0.0364763815429509",
//   ALEPH: "3.8292169251388091",
//   ALGO: "2.7476301689792554",
//   ALICE: "0.4180602006688963",
//   ALL: "113.9708941130614064",
//   AMD: "480.1390482683785224",
//   AMP: "107.7005923532579429",
//   ANG: "1.802442",
//   ANKR: "33.4280461307036604",
//   AOA: "430.0750000000014085",
//   APE: "0.1653849334325643",
//   API3: "0.499001996007984",
//   ARPA: "25.641025641025641",
//   ARS: "129.1419037066309202",
//   ASM: "48.2509047044632087",
//   AST: "11.0864745011086475",
//   ATA: "5.5111600992008818",
//   ATOM: "0.1005580974407964",
//   AUCTION: "0.16116035455278",
//   AUD: "1.4492753623188406",
//   AVAX: "0.0407331975560081",
//   AVT: "0.6309148264984227",
//   AWG: "1.7974858924319732",
//   AXS: "0.0606060606060606",
//   AZN: "1.6999999999999999",
//   BADGER: "0.2424242424242424",
//   BAL: "0.1779359430604982",
//   BAM: "1.9057380000000001",
//   BAND: "0.6253908692933083",
//   BAT: "2.3696682464454976",
//   BBD: "2.0193510000000001",
//   BCH: "0.0082088327039895",
//   BDT: "93.987840000000255",
//   BGN: "1.9089760000000001",
//   BHD: "0.3769951525963279",
//   BICO: "1.8084817795460711",
//   BIF: "2058.8840848260242948",
//   BIT: "1.9440124416796267",
//   BLZ: "9.910802775024777",
//   BMD: "1",
//   BND: "1.3914710339562068",
//   BNT: "1.9127773527161438",
//   BOB: "6.8703354716107433",
//   BOBA: "2.2560631697687535",
//   BOND: "0.1315789473684211",
//   BRL: "5.4046984124238883",
//   BSD: "1.0001754",
//   BSV: "0.017573457050471",
//   BTC: "0.0000443815804014",
//   BTN: "79.9474904882473192",
//   BTRST: "0.4306632213608958",
//   BUSD: "1",
//   BWP: "12.7225540476360413",
//   BYN: "2.5231489999999998",
//   BYR: "25231.4899999999976945",
//   BZD: "2.0159900000000002",
//   C98: "1.8421295017039698",
//   CAD: "1.28901",
//   CDF: "1999.2003198720511795",
//   CGLD: "0.9985022466300549",
//   CHF: "0.96824",
//   CHZ: "8.7183958151700087",
//   CLF: "0.03808059",
//   CLP: "925.9259259259259259",
//   CLV: "9.606147934678194",
//   CNH: "6.7473196272780638",
//   CNY: "6.7441999999999986",
//   COMP: "0.0162853187851152",
//   COP: "4301.4199999993622285",
//   COTI: "9.0950432014552069",
//   COVAL: "81.5993472052223582",
//   CRC: "683.0812999999845532",
//   CRO: "7.5958982149639195",
//   CRPT: "6.13685179502915",
//   CRV: "0.8007687379884689",
//   CTSI: "5.7987822557262975",
//   CTX: "0.2389486260454002",
//   CUC: "1",
//   CVC: "6.648936170212766",
//   CVE: "104.3500000000000193",
//   CZK: "23.9282000000000105",
//   DAI: "1.000450202591166",
//   DAR: "3.1595576619273302",
//   DASH: "0.0207060772336681",
//   DDX: "1.1173184357541899",
//   DESO: "0.1186943620178042",
//   DEXT: "6.3011972274732199",
//   DIA: "2.2121202066120273",
//   DJF: "178.055417",
//   DKK: "7.2674299999999994",
//   DNT: "19.3986420950533463",
//   DOGE: "14.8489123171727671",
//   DOP: "54.445976796213609",
//   DOT: "0.1303186290480224",
//   DREP: "1.7568517217146873",
//   DYP: "3.2347280402400168",
//   DZD: "145.5330000000006708",
//   EGP: "18.9295000000000126",
//   ELA: "0.6184291898577613",
//   ENJ: "1.718213058419244",
//   ENS: "0.0931966449207829",
//   EOS: "0.9523809523809524",
//   ERN: "0.5555555555555556",
//   ETB: "52.2104876250702231",
//   ETC: "0.0398168425243878",
//   ETH: "0.0006619053607715",
//   ETH2: "0.0006619053607715",
//   EUR: "0.9762383583575766",
//   FARM: "0.0216825672159584",
//   FET: "11.3895216400911162",
//   FIDA: "1.8873266018684533",
//   FIL: "0.1707796089146956",
//   FIS: "2.5246149962130775",
//   FJD: "2.2021333827785682",
//   FKP: "0.831264",
//   FLOW: "0.5600672080649678",
//   FORT: "3.4059945504087193",
//   FORTH: "0.2766251728907331",
//   FOX: "11.627906976744186",
//   FX: "3.6589828027808269",
//   GAL: "0.3355141754739138",
//   GALA: "17.3656334114786837",
//   GBP: "0.83141",
//   GBX: "80.3930254226864294",
//   GEL: "2.9325513196480938",
//   GFI: "0.8695652173913043",
//   GGP: "0.831264",
//   GHS: "8.1290100000000002",
//   GIP: "0.831264",
//   GLM: "3.9952057530962845",
//   GMD: "54.0900000000001242",
//   GMT: "0.9633911368015414",
//   GNF: "8675.5499000010670356",
//   GNT: "6.4283799087671467",
//   GODS: "2.1381227282446012",
//   GRT: "8.9766606822262118",
//   GST: "14.3884892086330935",
//   GTC: "0.3780718336483932",
//   GTQ: "7.7337654342756772",
//   GUSD: "1.0025062656641604",
//   GYD: "209.3888799999983256",
//   GYEN: "138.8985346204597541",
//   HIGH: "0.5954153021732659",
//   HKD: "7.8501500556183131",
//   HNL: "24.5931989999999975",
//   HOPR: "9.1996320147194112",
//   HRK: "7.3313999999999989",
//   HTG: "116.8902972870930903",
//   HUF: "388.2299999999981346",
//   ICP: "0.1365653806759986",
//   IDEX: "13.2187706543291474",
//   IDR: "14953.9000000058987154",
//   ILS: "3.4382800000000005",
//   IMP: "0.831264",
//   IMX: "1.0092344956350608",
//   INDEX: "0.2652519893899204",
//   INR: "79.8745011837401075",
//   INV: "0.0085375224109963",
//   IOTX: "25.8631837579206",
//   IQD: "1459.6865000000476612",
//   ISK: "135.5999999999995986",
//   JASMY: "104.0582726326742976",
//   JEP: "0.831264",
//   JMD: "151.7338500000000276",
//   JOD: "0.7104",
//   JPY: "137.7903932537823463",
//   JUP: "72.4060531460430092",
//   KEEP: "5.3134962805526036",
//   KES: "118.5499999999995074",
//   KGS: "79.6264999999999775",
//   KHR: "4083.2993058391180073",
//   KMF: "464.6235619900756407",
//   KNC: "0.6646505599680968",
//   KRL: "2.1647364433380236",
//   KRW: "1305.690000000009653",
//   KSM: "0.0161629222563439",
//   KWD: "0.3074459725192492",
//   KYD: "0.8333577",
//   KZT: "480.120606296301631",
//   LAK: "15044.8209999945557743",
//   LBP: "1511.0305228165608945",
//   LCX: "13.2275132275132275",
//   LINK: "0.1427755568246716",
//   LKR: "358.0251333643621782",
//   LOOM: "19.0476190476190476",
//   LPT: "0.1049317943336831",
//   LQTY: "1.0582010582010582",
//   LRC: "2.2552999548940009",
//   LRD: "152.4934199089309296",
//   LSL: "16.9584538231477468",
//   LTC: "0.0176522506619594",
//   LYD: "4.9035890000000001",
//   MAD: "10.3105859999999989",
//   MANA: "1.0351966873706004",
//   MASK: "0.6230529595015576",
//   MATH: "4.6360686138154845",
//   MATIC: "1.1099395082967978",
//   MCO2: "0.2212389380530973",
//   MDL: "19.2975685063681976",
//   MDT: "31.352876626430475",
//   MEDIA: "0.0573888091822095",
//   METIS: "0.0343347639484979",
//   MGA: "4206.9835927639882204",
//   MINA: "1.3477088948787062",
//   MIR: "5.4288816503800217",
//   MKD: "60.0342970000001446",
//   MKR: "0.00098171554792",
//   MLN: "0.0382628658886551",
//   MMK: "1851.7887000000427771",
//   MNT: "3146.8449959999863411",
//   MONA: "0.0008789122581893",
//   MOP: "8.0825349674710298",
//   MPL: "0.0705218617771509",
//   MUR: "45.497788000000062",
//   MUSD: "1.0050756319413036",
//   MUSE: "0.0780274656679151",
//   MVR: "13.4890509373541496",
//   MWK: "1026.5886459295760189",
//   MXN: "20.4384873066774582",
//   MYR: "4.4500000000000001",
//   MZN: "63.867849754715523",
//   NAD: "15.8227848101265823",
//   NCT: "52.0697734964852903",
//   NGN: "415.4000000000027333",
//   NIO: "35.8601610000000626",
//   NKN: "9.1449474165523548",
//   NMR: "0.0687049124012367",
//   NOK: "9.9061883958909131",
//   NPR: "127.9156779850722404",
//   NU: "5.2617732175743225",
//   NZD: "1.6050800000000001",
//   OGN: "4.4247787610619469",
//   OMG: "0.5089058524173028",
//   OMR: "0.3850383",
//   OP: "1.4064697609001406",
//   ORCA: "0.9709680551509855",
//   ORN: "0.7538635506973238",
//   OXT: "8.6058519793459552",
//   PAB: "0.9994845658094121",
//   PAX: "1.0006003602161297",
//   PEN: "3.904107316101905",
//   PERP: "1.1305183426601097",
//   PGK: "3.5694590000000001",
//   PHP: "56.1629894885348873",
//   PKR: "221.2920700000021703",
//   PLA: "2.5458248472505092",
//   PLN: "4.6484",
//   PLU: "0.1308044473512099",
//   POLS: "1.6903313049357674",
//   POLY: "4.7961630695443645",
//   POND: "80.9061488673139159",
//   POWR: "4.0168708576019281",
//   PRO: "1.2269938650306748",
//   PRQ: "4.6849379245724994",
//   PYG: "6871.6779999990601249",
//   QAR: "3.6409989590383976",
//   QNT: "0.0093632958801498",
//   QSP: "39.4166338194718171",
//   QUICK: "0.0111172873818788",
//   RAD: "0.5361930294906166",
//   RAI: "0.3424657534246575",
//   RARI: "0.3577817531305903",
//   RBN: "3.8385505633072952",
//   REN: "6.3552589768033047",
//   REP: "0.1203369434416366",
//   REPV2: "0.1203369434416366",
//   REQ: "8.5579803166452717",
//   RGT: "0.1932367149758454",
//   RLC: "1.0158988164778788",
//   RLY: "22.6244343891402715",
//   RNDR: "1.6448721111933547",
//   RON: "4.8235",
//   ROSE: "16.6209590293359927",
//   RSD: "114.5899999999995702",
//   RUB: "55.8943170000001234",
//   RWF: "1024.7581200000123971",
//   SAND: "0.7217610970768676",
//   SAR: "3.7551129999999999",
//   SBD: "8.1599689999999967",
//   SCR: "14.1659272052665518",
//   SEK: "10.2090600000000002",
//   SGD: "1.391644925693815",
//   SHIB: "83927.8220730172052035",
//   SHP: "0.8145312372729494",
//   SHPING: "78.9079144638207212",
//   SKL: "18.018018018018018",
//   SLL: "13157.8947368421052632",
//   SNT: "31.4317146000314317",
//   SNX: "0.347041471455839",
//   SOL: "0.0220409962530306",
//   SOS: "575.9572409344330277",
//   SPELL: "966.7907381447285735",
//   SRD: "22.6360000000000032",
//   SSP: "130.2600000000002694",
//   STD: "23658.2999999734804652",
//   STORJ: "1.4520110352838682",
//   STX: "2.3474178403755869",
//   SUKU: "9.5877277085330777",
//   SUPER: "6.8422853232979815",
//   SUSHI: "0.7017543859649123",
//   SVC: "8.7506820000000013",
//   SYN: "0.8071025020177563",
//   SZL: "16.9614165089537622",
//   THB: "36.582000000000026",
//   TIME: "0.0107434464976364",
//   TJS: "10.0748186255589887",
//   TMT: "3.5035841666024343",
//   TND: "3.0639999999999996",
//   TOP: "2.3557126030624264",
//   TRAC: "4.3402777777777778",
//   TRB: "0.0598981731057203",
//   TRIBE: "6.4246707356247992",
//   TRU: "11.0314396028681743",
//   TRY: "17.5630742686208982",
//   TTD: "6.7883309999999984",
//   TWD: "29.8619957727358784",
//   TZS: "2332.0000000000848848",
//   UAH: "29.6041209999999811",
//   UGX: "3792.1880925293894577",
//   UMA: "0.3673769287288758",
//   UNFI: "0.1501501501501502",
//   UNI: "0.1360174102285092",
//   UPI: "52.5624178712220762",
//   USD: "1.0",
//   USDC: "1",
//   USDT: "0.9999250056245782",
//   UST: "22.7451069588654741",
//   UYU: "42.1229991575400168",
//   UZS: "10869.5652173913043478",
//   VEF: "403133000033.28911061075",
//   VES: "4031330.0003328911061075",
//   VGX: "1.8721332958906674",
//   VND: "23417.0000000197241391",
//   VUV: "118.8995130000005358",
//   WAMPL: "0.2564102564102564",
//   WBTC: "0.0000438613612549",
//   WCFG: "3.3277870216306156",
//   WLUNA: "9725.7342929391169033",
//   WST: "2.721415",
//   XAF: "640.1744459999934143",
//   XAG: "0.0531095650326624",
//   XAU: "0.0005833965346246",
//   XCD: "2.7026",
//   XCN: "11.0168557893577173",
//   XDR: "0.736094",
//   XLM: "8.6432664632617959",
//   XOF: "625",
//   XPD: "0.00054",
//   XPF: "113.1999999999999864",
//   XPT: "0.0011422044545974",
//   XRP: "2.7693711976533456",
//   XTS: "3516.5675540110404591",
//   XTZ: "0.585480093676815",
//   XYO: "142.146410803127221",
//   YER: "250.2496239999399401",
//   YFI: "0.00015307992992",
//   YFII: "0.0006885250416558",
//   ZAR: "17.0328999999999981",
//   ZEC: "0.0155848203849451",
//   ZEN: "0.0567054153671676",
//   ZMW: "16.4272504429608082",
//   ZRX: "3.1149979363138672",
//   ZWD: "485.6008999999892012",
//   ZWL: "322.0000000000001288",
// };

type ConversionContextType = {
  isLoading: boolean,
  conversion: object | undefined,
  fetchConversion: () => Promise<void>
}

export const ConversionContext = createContext<ConversionContextType>({
  isLoading: false,
  conversion: {},
  fetchConversion: async () => {}
});

export const ConversionContextProvider = (props: any) => {
  const { children } = props;

  const ranOnce = useRef(false);
  
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [conversion, setConversion] = useState<any>(undefined);

  const fetchConversion = async () => {
    setIsLoading(true);
    fetch("https://api.coinbase.com/v2/exchange-rates?currency=USD")
      .then(response => response.json())
      .then(data => {
        const rates = data.data.rates;
        setConversion(rates);
      })
      .finally(() => {
        setIsLoading(false);
      })
  }
  
  useEffect(() => {
    // In React 18 that mounts, unmounts, then remounts in strict mode
    if(!ranOnce.current) {
      ranOnce.current = true;
      fetchConversion();
      setInterval(() => {
        fetchConversion();
      }, 1000 * 60 * 5); // 5 minute intervals
    }
  }, [])

  return (
    <ConversionContext.Provider
      value={{
        isLoading,
        conversion,
        fetchConversion
      }}>
      {children}
    </ConversionContext.Provider>
  )
}
